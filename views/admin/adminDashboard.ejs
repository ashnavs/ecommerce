
 <%- include('../partials/adminHeader') %>

     <%- include('../partials/adminSidebar') %>

            <!-- index body start -->
            <div class="page-body">
                <div class="container-fluid">
                    <div class="row">
                        <!-- chart caard section start -->
                        <div class="col-sm-6 col-xxl-3 col-lg-6">
                            <div class="main-tiles border-5 border-0  card-hover card o-hidden">
                                <div class="custome-1-bg b-r-4 card-body">
                                    <div class="media align-items-center static-top-widget">
                                        <div class="media-body p-0">
                                            <span class="m-0">Total Revenue </span>
                                            <h4 class="mb-0 counter"><%= totalRevenue%>
                                                <span class="badge badge-light-primary grow">
                                                    <i data-feather="trending-up"></i>8.5%</span>
                                            </h4>
                                        </div>
                                        <div class="align-self-center text-center">
                                            <i class="ri-database-2-line"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-xxl-3 col-lg-6">
                            <div class="main-tiles border-5 card-hover border-0 card o-hidden">
                                <div class="custome-2-bg b-r-4 card-body">
                                    <div class="media static-top-widget">
                                        <div class="media-body p-0">
                                            <span class="m-0">Total Orders</span>
                                            <h4 class="mb-0 counter"><%=totalProductsSold%>
                                                <span class="badge badge-light-danger grow">
                                                    <i data-feather="trending-down"></i>8.5%</span>
                                            </h4>
                                        </div>
                                        <div class="align-self-center text-center">
                                            <i class="ri-shopping-bag-3-line"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-xxl-3 col-lg-6">
                            <div class="main-tiles border-5 card-hover border-0  card o-hidden">
                                <div class="custome-3-bg b-r-4 card-body">
                                    <div class="media static-top-widget">
                                        <div class="media-body p-0">
                                            <span class="m-0">Total Products</span>
                                            <h4 class="mb-0 counter"><%= totalUniqueProducts%>
                                                <a href="add-new-product.html" class="badge badge-light-secondary grow">
                                                    ADD NEW</a>
                                            </h4>
                                        </div>

                                        <div class="align-self-center text-center">
                                            <i class="ri-chat-3-line"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-xxl-3 col-lg-6">
                            <div class="main-tiles border-5 card-hover border-0 card o-hidden">
                                <div class="custome-4-bg b-r-4 card-body">
                                    <div class="media static-top-widget">
                                        <div class="media-body p-0">
                                            <span class="m-0">Total Customers</span>
                                            <h4 class="mb-0 counter"><%= totalUsers%>
                                                <span class="badge badge-light-success grow">
                                                    <i data-feather="trending-down"></i>8.5%</span>
                                            </h4>
                                        </div>

                                        <div class="align-self-center text-center">
                                            <i class="ri-user-add-line"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <!-- Best Selling Product Start -->
                        <div class="col-xl-6 col-md-12">
                            <div class="card o-hidden card-hover">
                                <div class="card-header card-header-top card-header--2 px-0 pt-0">
                                    <div class="card-header-title">
                                        <h4>Best Selling Product</h4>
                                    </div>

                                    <!-- <div class="best-selling-box d-sm-flex d-none">
                                        <span>Short By:</span>
                                        <div class="dropdown">
                                            <button class="btn p-0 dropdown-toggle" type="button"
                                                id="dropdownMenuButton1" data-bs-toggle="dropdown"
                                                data-bs-auto-close="true">Today</button>
                                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                                <li><a class="dropdown-item" href="#">Action</a></li>
                                                <li><a class="dropdown-item" href="#">Another action</a></li>
                                                <li><a class="dropdown-item" href="#">Something else here</a></li>
                                            </ul>
                                        </div>
                                    </div> -->
                                </div>

                                <div class="card-body p-0">
                                    <div>
                                        <div class="table-responsive">
                                            <table class="best-selling-table w-image
                                            w-image
                                            w-image table border-0">
                                            <tbody>
                                                <% topSellingProducts.forEach(product => { %>
                                                    <tr>
                                                        <td>
                                                            <div class="best-product-box">
                                                                <div class="product-image">
                                                                    <img src="/productImage/<%= product.image %>" class="img-fluid">
                                                                </div>
                                                                <div class="product-name">
                                                                    <h5><%= product.name %></h5>
                                                                    <h6><%= product.date %></h6>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        
                                    
                                                        <td>
                                                            <div class="product-detail-box">
                                                                <h6>Price</h6>
                                                                <h5>₹<%= product.discountPrice %></h5>
                                                            </div>
                                                        </td>
                                    
                                                        <td>
                                                            <div class="product-detail-box">
                                                                <h6>Orders</h6>
                                                                <h5><%= product.quantitySold %></h5>
                                                            </div>
                                                        </td>
                                    
                                                        <td>
                                                            <div class="product-detail-box">
                                                                <h6>Stock</h6>
                                                                <h5><%= product.stock %></h5>
                                                            </div>
                                                        </td>
                                    
                                                        <td>
                                                            <div class="product-detail-box">
                                                                <h6>Amount</h6>
                                                                <h5>₹<%= product.amount %></h5>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                <% }); %>
                                            </tbody>
                                        </table>
                                           
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> 
                        <!-- Best Selling Product End -->


                        <!-- Recent orders start-->
                        <div class="col-xl-6">
                            <div class="card o-hidden card-hover">
                                <div class="card-header card-header-top card-header--2 px-0 pt-0">
                                    <div class="card-header-title">
                                        <h4>Recent Orders</h4>
                                    </div>

                                 
                                </div>

                                <div class="card-body p-0">
                                    <div>
                                        <div class="table-responsive">
                                            <table class="best-selling-table table border-0">
                                                <tbody>
                                                    <% recentOrders.forEach(order => { %>
                                                        <tr>
                                                            <td>
                                                                <div class="best-product-box">
                                                                    <div class="product-name">
                                                                        <h5><%= order.products[0].product.title %></h5>
                                                                        <h6>#<%= order._id %></h6>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                
                                                            <td>
                                                                <div class="product-detail-box">
                                                                    <h6>Date Placed</h6>
                                                                    <h5><%= order.createdAt.toLocaleDateString() %></h5>
                                                                </div>
                                                            </td>
                                                
                                                            <td>
                                                                <div class="product-detail-box">
                                                                    <h6>Price</h6>
                                                                    <h5>₹<%= order.grandTotal %></h5>
                                                                </div>
                                                            </td>
                                                
                                                            <td>
                                                                <div class="product-detail-box">
                                                                    <h6>Order Status</h6>
                                                                    <h5><%= order.status %></h5>
                                                                </div>
                                                            </td>
                                                
                                                            <td>
                                                                <div class="product-detail-box">
                                                                    <h6>Payment</h6>
                                                                    <h5 class="text-danger"><%= order.payment_status ? "Paid" : "Unpaid" %></h5>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    <% }); %>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> 
                        <!-- Recent orders end-->

                       


                        <!-- Transactions start-->
                        <div class="col-xxl-4 col-md-6">
                            <div class="card o-hidden card-hover">
                                <div class="card-header border-0">
                                    <div class="card-header-title">
                                        <h4>Transactions</h4>
                                    </div>
                                </div>

                                <div class="card-body pt-0">
                                    <div>
                                        <div class="table-responsive">
                                            <table class="user-table transactions-table table border-0">
                                                <tbody>
                                                    <tr>
                                                        <td class="td-color-1">
                                                            <div class="transactions-icon">
                                                                <i class="ri-check-line"></i>
                                                            </div>
                                                            <div class="transactions-name">
                                                                <h6>Razorpay</h6>
                                                                <p>Total Amount Received</p>
                                                            </div>
                                                        </td>
                                                        <td class="success">+₹<%= razorpayTotal.length ? razorpayTotal[0].total : 0 %></td>
                                                    </tr>
                                                    <tr>
                                                        <td class="td-color-2">
                                                            <div class="transactions-icon">
                                                                <i class="ri-exchange-dollar-line"></i>
                                                            </div>
                                                            <div class="transactions-name">
                                                                <h6>COD</h6>
                                                                <p>Total Amount Received</p>
                                                            </div>
                                                        </td>
                                                        <td class="lost">+₹<%= codTotal.length ? codTotal[0].total : 0 %></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Transactions end-->

                         <!-- Graph -->
        
                         <div class="col-lg-8" style="width: 100%;">
                            <div class="col-xl-12 col-lg-12">
                            <div class="card mb-4" >
                                <article class="card-body">
                                <h5 class="card-title">Sale statistics</h5>
                                <div>
                                    <canvas id="saleChart" height="100px"></canvas>
                                </div>
                                <div class="graph-options ml-3" style="display: flex;">
                                    <button
                                    id="monthlyBtn"
                                    class="btn btn-white shadow border btn-sm mt-2"
                                    >
                                    Monthly
                                    </button>
                                    <button id="weeklyBtn" class="btn  btn-white shadow border btn-sm mt-2" style="margin-left: 10px;">Weekly</button>
                                    <button
                                    id="yearlyBtn"
                                    class="btn btn-white shadow border btn-sm mt-2" style="margin-left: 10px;"
                                    >
                                    Yearly
                                    </button>
                                </div>
                                </article>
                            </div>
                            </div>
                        </div>
                        <!-- Graph End -->

                     


                    </div>
                </div>
                <!-- Container-fluid Ends-->

                <!-- footer start-->
                <div class="container-fluid">
                    <footer class="footer">
                        <div class="row">
                            <div class="col-md-12 footer-copyright text-center">
                                <p class="mb-0">Copyright 2023 © Lapkart</p>
                            </div>
                        </div>
                    </footer>
                </div>
                <!-- footer End-->
            </div>
            <!-- index body end -->

        </div>
        <!-- Page Body End -->
    </div>
    <!-- page-wrapper End-->

    <!-- Modal Start -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog  modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <h5 class="modal-title" id="staticBackdropLabel">Logging Out</h5>
                    <p>Are you sure you want to log out?</p>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    <div class="button-box">
                        <button type="button" class="btn btn--no" data-bs-dismiss="modal">No</button>
                        <button type="button" class="btn  btn--yes btn-primary">Yes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal End -->

    <!-- latest js -->
    <script src="/assetsb/js/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap js -->
    <script src="/assetsb/js/bootstrap/bootstrap.bundle.min.js"></script>

    <!-- feather icon js -->
    <script src="/assetsb/js/icons/feather-icon/feather.min.js"></script>
    <script src="/assetsb/js/icons/feather-icon/feather-icon.js"></script>

    <!-- scrollbar simplebar js -->
    <script src="/assetsb/js/scrollbar/simplebar.js"></script>
    <script src="/assetsb/js/scrollbar/custom.js"></script>

    <!-- Sidebar jquery -->
    <script src="/assetsb/js/config.js"></script>

    <!-- tooltip init js -->
    <script src="/assetsb/js/tooltip-init.js"></script>

    <!-- Plugins JS -->
    <script src="/assetsb/js/sidebar-menu.js"></script>
    <script src="/assetsb/js/notify/bootstrap-notify.min.js"></script>
    <script src="/assetsb/js/notify/index.js"></script>

    <!-- Apexchar js -->
    <script src="/assetsb/js/chart/apex-chart/apex-chart1.js"></script>
    <script src="/assetsb/js/chart/apex-chart/moment.min.js"></script>
    <script src="/assetsb/js/chart/apex-chart/apex-chart.js"></script>
    <script src="/assetsb/js/chart/apex-chart/stock-prices.js"></script>
    <script src="/assetsb/js/chart/apex-chart/chart-custom1.js"></script>


    <!-- slick slider js -->
    <script src="/assetsb/js/slick.min.js"></script>
    <script src="/assetsb/js/custom-slick.js"></script>

    <!-- customizer js -->
    <script src="/assetsb/js/customizer.js"></script>

    <!-- ratio js -->
    <script src="/assetsb/js/ratio.js"></script>

    <!-- sidebar effect -->
    <script src="/assetsb/js/sidebareffect.js"></script>

    <!-- Theme js -->
    <script src="/assetsb/js/script.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--Graph-->
    <script>

        document.addEventListener("DOMContentLoaded", function () {
          if ($("#saleChart").length) {
            var saleCtx = document.getElementById("saleChart").getContext("2d");
            var saleChart;
            var filter = 'year';
      
            function updateChart(salesData) {
              if (saleChart) {
                saleChart.destroy();
              }
      
              var chartLabels = salesData.map((item) =>
                // isYear ? item.year : item.month
                filter === "year" ? item.year : filter === "month" ? item.month : item.week
              );
              var salesValues = salesData.map((item) => item.sales);
      
              saleChart = new Chart(saleCtx, {
                type: "bar",
                data: {
                  labels: chartLabels,
                  datasets: [
                    {
                      label: "Sales",
                      tension: 0.3,
                      fill: true,
                      backgroundColor: "rgba(44, 120, 220, 0.2)",
                      borderColor: "rgba(44, 120, 220)",
                      data: salesValues,
                    },
                  ],
                },
                options: {
                  plugins: {
                    legend: {
                      labels: {
                        usePointStyle: true,
                      },
                    },
                  },
                },
              });
            }
      
            function fetchSalesData(endpoint) {
              fetch(endpoint)
                .then((response) => response.json())
                .then((data) => {
                  console.log(data); // Add this line to log the data
                  updateChart(data);
                })
                .catch((error) => {
                  console.error("Error fetching data:", error);
                });
            }
      
            // Initial fetch for monthly sales data
            filter = "month"
            fetchSalesData("/admin/sales-data"); // Assuming this fetches monthly sales data
      
            // Monthly button click event
            document
              .getElementById("monthlyBtn")
              .addEventListener("click", function () {
                filter = "month";
                fetchSalesData("/admin/sales-data"); // Fetch monthly sales data on button click
              });
      
            // Yearly button click event
            document
              .getElementById("yearlyBtn")
              .addEventListener("click", function () {
                filter = "year";
                fetchSalesData("/admin/sales-data/yearly"); // Fetch yearly sales data on button click
              });
      
               // Yearly button click event
            document
              .getElementById("weeklyBtn")
              .addEventListener("click", function () {
                filter = "week";
                fetchSalesData("/admin/sales-data/weekly"); // Fetch yearly sales data on button click
              });
          }
        });
      </script>
</body>


<!-- Mirrored from themes.pixelstrap.com/fastkart/back-end/index by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 04 Sep 2023 05:49:24 GMT -->
</html>